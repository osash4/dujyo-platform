# üÜò Troubleshooting para Artistas - XWave MVP

**Versi√≥n:** MVP v0.1  
**√öltima actualizaci√≥n:** Noviembre 2024

---

## üîç Problemas Comunes y Soluciones

### 1. Error: "Artist is required"

**S√≠ntoma:**
```
{
  "success": false,
  "message": "Artist is required",
  "content_id": "",
  "file_url": null
}
```

**Causa:**
El campo `artist` es obligatorio en el form-data del upload pero no se est√° enviando.

**Soluci√≥n:**
Agregar el campo `artist` al form-data con el mismo valor que `artist_name` del registro.

**Ejemplo con cURL:**
```bash
curl -X POST http://localhost:8083/api/v1/upload/content \
  -H "Authorization: Bearer {tu_token}" \
  -F "file=@cancion.mp3" \
  -F "title=Mi Canci√≥n" \
  -F "artist=Tu Nombre Art√≠stico" \  # ‚úÖ REQUERIDO
  -F "content_type=audio" \
  -F "price=0.0"
```

**Ejemplo con Postman:**
- Agregar campo `artist` (tipo: Text) con valor: tu `artist_name` del registro

---

### 2. Error: "JWT token invalid" o "Missing request extension"

**S√≠ntoma:**
```
{
  "success": false,
  "message": "Unauthorized" o "Missing request extension"
}
```

**Causa:**
- Token JWT expirado o mal formateado
- Header de autorizaci√≥n incorrecto
- Token no se est√° enviando correctamente

**Soluci√≥n:**
1. Verificar que el token est√© completo (no truncado)
2. Asegurar que el header sea exactamente: `Authorization: Bearer {token}`
3. Si el token expir√≥, hacer un nuevo registro o login

**Ejemplo correcto:**
```bash
# ‚úÖ CORRECTO
curl -X POST http://localhost:8083/api/v1/upload/content \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  ...

# ‚ùå INCORRECTO (sin "Bearer ")
curl -X POST http://localhost:8083/api/v1/upload/content \
  -H "Authorization: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  ...
```

**Verificar token:**
- El token debe comenzar con `eyJ` (base64)
- Debe tener 3 partes separadas por puntos: `header.payload.signature`

---

### 3. Error: "Artist verification required"

**S√≠ntoma:**
```
{
  "success": false,
  "message": "Artist verification required. Please complete artist verification first.",
  "content_id": "",
  "file_url": null
}
```

**Causa:**
No se complet√≥ la verificaci√≥n de artista antes de intentar subir contenido.

**Soluci√≥n:**
1. Ejecutar el endpoint de verificaci√≥n primero:
```bash
curl -X POST http://localhost:8083/api/v1/artist/request-verification \
  -H "Authorization: Bearer {tu_token}" \
  -H "Content-Type: application/json" \
  -d '{}'
```

2. Verificar que la respuesta sea:
```json
{
  "success": true,
  "message": "Verification request submitted successfully. Auto-approved for MVP.",
  "verified": true
}
```

3. Esperar 1-2 segundos antes de intentar el upload

**Nota:** En MVP, la verificaci√≥n es autom√°tica, pero el endpoint debe ejecutarse al menos una vez.

---

### 4. Error: "File not found" o "Content not found"

**S√≠ntoma:**
```
HTTP/1.1 404 Not Found
{
  "message": "Content not found"
}
```

**Causa:**
- Content ID incorrecto
- El upload no fue exitoso
- El archivo no se guard√≥ correctamente en el filesystem

**Soluci√≥n:**
1. Verificar que el upload fue exitoso:
   - Revisar la respuesta del upload
   - Confirmar que recibiste un `content_id`
   - Verificar que `success: true`

2. Usar el `content_id` correcto de la respuesta del upload

3. Verificar que el archivo existe:
```bash
# Ver archivos subidos
ls -lh xwave-backend/uploads/audio/
```

4. Si el archivo no existe, intentar upload nuevamente

---

### 5. Error: "Database connection failed" o "Internal server error"

**S√≠ntoma:**
```
HTTP/1.1 500 Internal Server Error
{
  "message": "Internal server error"
}
```

**Causa:**
- Base de datos PostgreSQL no est√° corriendo
- Variables de entorno incorrectas
- Problema de conexi√≥n a la base de datos

**Soluci√≥n:**
1. Verificar que PostgreSQL est√° corriendo:
```bash
# macOS
brew services list | grep postgresql

# Linux
sudo systemctl status postgresql
```

2. Verificar variables de entorno en `.env`:
```bash
cat xwave-backend/.env
# Debe tener:
# DATABASE_URL=postgresql://usuario@localhost:5432/xwave_blockchain
# JWT_SECRET=tu_secret_key
```

3. Verificar que la base de datos existe:
```bash
psql -U $(whoami) -d xwave_blockchain -c "SELECT 1;"
```

4. Revisar logs del servidor para m√°s detalles

---

### 6. Error: "File too large"

**S√≠ntoma:**
```
{
  "success": false,
  "message": "File too large. Maximum size is 50MB. Your file is XX.XXMB.",
  "content_id": "",
  "file_url": null
}
```

**Causa:**
El archivo excede el l√≠mite de tama√±o (50MB por defecto en MVP).

**Soluci√≥n:**
1. Reducir el tama√±o del archivo de audio
2. Usar un formato m√°s comprimido (MP3 en lugar de WAV)
3. Comprimir el archivo antes de subirlo

**L√≠mites actuales:**
- Tama√±o m√°ximo: 50MB
- Formatos soportados: MP3, WAV, OGG, FLAC, M4A, AAC

---

### 7. Error: "Upload limit reached"

**S√≠ntoma:**
```
{
  "success": false,
  "message": "Upload limit reached. Maximum 10 uploads per day.",
  "content_id": "",
  "file_url": null
}
```

**Causa:**
Se alcanz√≥ el l√≠mite de uploads por d√≠a (10 por defecto en MVP).

**Soluci√≥n:**
1. Esperar hasta el d√≠a siguiente
2. O contactar al administrador para resetear el l√≠mite

**Nota:** Este es un l√≠mite de rate limiting para prevenir abuso. En producci√≥n, los l√≠mites pueden ser diferentes.

---

### 8. Error: "Title is required"

**S√≠ntoma:**
```
{
  "success": false,
  "message": "Title is required",
  "content_id": "",
  "file_url": null
}
```

**Causa:**
El campo `title` es obligatorio pero no se est√° enviando en el form-data.

**Soluci√≥n:**
Agregar el campo `title` al form-data:
```bash
-F "title=Mi Canci√≥n"
```

**Campos requeridos en upload:**
- ‚úÖ `file`: Archivo de audio
- ‚úÖ `title`: T√≠tulo de la canci√≥n
- ‚úÖ `artist`: Nombre del artista
- ‚úÖ `content_type`: "audio"
- ‚ö†Ô∏è `description`: Opcional
- ‚ö†Ô∏è `genre`: Opcional
- ‚ö†Ô∏è `price`: Opcional (default: 0.0)

---

## üîß Comandos de Verificaci√≥n

### Verificar que el servidor est√° corriendo
```bash
curl http://localhost:8083/health
```

**Respuesta esperada:**
```json
{
  "status": "ok",
  "timestamp": "2024-11-XX..."
}
```

---

### Verificar que el registro funciona
```bash
curl -X POST http://localhost:8083/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@test.com",
    "password": "test123456",
    "username": "testuser",
    "artist_name": "Test Artist"
  }'
```

---

### Verificar que la verificaci√≥n funciona
```bash
curl -X POST http://localhost:8083/api/v1/artist/request-verification \
  -H "Authorization: Bearer {tu_token}" \
  -H "Content-Type: application/json" \
  -d '{}'
```

---

### Verificar archivos subidos
```bash
# Listar archivos en uploads
ls -lh xwave-backend/uploads/audio/

# Ver tama√±o total
du -sh xwave-backend/uploads/
```

---

### Verificar base de datos
```bash
# Conectar a PostgreSQL
psql -U $(whoami) -d xwave_blockchain

# Ver usuarios registrados
SELECT user_id, email, username, artist_name FROM users;

# Ver contenido subido
SELECT content_id, title, artist_name, created_at FROM content;
```

---

## üìû Contacto de Soporte

Si ninguno de estos pasos resuelve el problema:

1. **Revisar logs del servidor:**
   ```bash
   # Ver logs en tiempo real
   tail -f xwave-backend/server.log
   ```

2. **Contactar soporte:**
   - WhatsApp/Telegram: `[AGREGAR_NUMERO]`
   - Email: `[AGREGAR_EMAIL]`

3. **Proporcionar informaci√≥n:**
   - Descripci√≥n del error
   - Endpoint que fall√≥
   - Headers y body del request
   - Logs relevantes del servidor

---

## üìö Recursos Adicionales

- **Gu√≠a completa de onboarding:** `ONBOARDING_ARTISTS.md`
- **Gu√≠a r√°pida para artistas:** `QUICK_START_ARTIST.md`
- **Plan de acci√≥n:** `ONBOARDING_ACTION_PLAN.md`
- **Testing t√©cnico:** `TESTING_MVP.md`

---

**√öltima actualizaci√≥n:** Noviembre 2024

